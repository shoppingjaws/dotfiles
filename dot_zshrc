#==================
# Zsh
#==================
echo "loading Zsh..."
source ~/.zplug/init.zsh
# éå»ã«å…¥åŠ›ã—ãŸã‚³ãƒãƒ³ãƒ‰ã®å±¥æ­´ãŒç°è‰²ã®ã‚µã‚¸ã‚§ã‚¹ãƒˆã§å‡ºã‚‹
zplug "zsh-users/zsh-autosuggestions"
# 256è‰²è¡¨ç¤ºã«ã™ã‚‹
zplug "chrissicool/zsh-256color"
# ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ
zplug "zsh-users/zsh-syntax-highlighting"

# Install plugins if there are plugins that have not been installed
if ! zplug check --verbose; then
  printf "Install? [y/N]: "
  if read -q; then
    echo; zplug install
  fi
fi
# Then, source plugins and add commands to $PATH
zplug load

# Zsh History ======
HISTFILE=$HOME/.zsh_history
HISTSIZE=10000
SAVEHIST=1000000
# å±¥æ­´ã‚’å…±æœ‰
set -o SHARE_HISTORY
set -o HIST_REDUCE_BLANKS
set -o HIST_FIND_NO_DUPS
set -o EXTENDED_HISTORY
# é‡è¤‡ã—ãŸå±¥æ­´ã‚’ç„¡è¦–
set -o HIST_IGNORE_DUPS
set -o HIST_IGNORE_ALL_DUPS
DIRSTACKSIZE=30
# ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒ
function select-history() {
  BUFFER=$(history -n -r 1 | fzf --no-sort +m --query "$LBUFFER" --prompt="History > ")
  CURSOR=$#BUFFER
}
zle -N select-history
bindkey '^r' select-history

# Zsh Directory Jump =====
set -o auto_pushd
set -o pushd_ignore_dups
set -o auto_cd

#==================
# Alias
#==================
echo "loading Alias..."
alias cza="chezmoi apply;exec zsh"
alias cze="chezmoi edit"
alias p8="ping 8.8.8.8"
alias tf="terraform"
alias tg="terragrunt"
alias gc="git checkout"
alias gw="git worktree"
function gcb(){
  git checkout -b develop/"$1"
}
function gwb(){
  gwb_name=$(git rev-parse --show-toplevel | sed 's|.*/github.com/||')
  # ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã®å­˜åœ¨ç¢ºèª
  if git ls-remote --heads origin develop/"$1" | grep -q develop/"$1"; then
    # ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã€ãã‚Œã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
    echo "ğŸ”„ ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒ 'origin/develop/$1' ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚æ—¢å­˜ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¾ã™..."
    git worktree add --track -b develop/"$1" ~/worktree/develop/"$gwb_name"/"$1" origin/develop/"$1" && cd ~/worktree/develop/"$gwb_name"/"$1"
  else
    # ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã€æ–°è¦ä½œæˆ
    echo "âœ¨ ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æ–°è¦ãƒ–ãƒ©ãƒ³ãƒ 'develop/$1' ã‚’ä½œæˆã—ã¾ã™..."
    git worktree add --checkout -b develop/"$1" ~/worktree/develop/"$gwb_name"/"$1" && cd ~/worktree/develop/"$gwb_name"/"$1"
  fi
}

alias z="z -r"
alias kb="kubectl"
alias kbe="kubectl exec"
alias dc="docker compose"
alias lg="lazygit"
alias ls="eza -alhg"
alias cat="bat --style=plain"
alias tree="eza -T"
alias dps="docker ps"
alias ava="aws-vault"
alias cw='cd $(ghq list -p | fzf)'
alias icode="code-insiders"
# jump to default branch
alias gcm='git checkout $(git symbolic-ref refs/remotes/origin/HEAD | sed "s@^refs/remotes/origin/@@")'
alias gr='git pull --rebase origin $(git symbolic-ref refs/remotes/origin/HEAD | sed "s@^refs/remotes/origin/@@")'
alias gp='git push --set-upstream origin "$(git branch --show-current)"'
alias ghp="gh pr view --web"
alias gac='cd $(git rev-parse --show-toplevel) && git add . && git commit -m "$(gh commit)" && cd -'
alias ga="git add --all;git diff --staged --stat;"
alias kz="kustomize"

# Git Auto Commit Settings
export FINE_TUNE_PARAMS='{"temperature": 0.7}'
export PROMPT_OVERRIDE="ä¸ãˆã‚‰ã‚ŒãŸã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’èª¿æŸ»ãƒ»èª¬æ˜ã—ã€Conventional Commitsãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™ã€‚1è¡Œã§ç°¡æ½”ã«è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚æ—¥æœ¬èªã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚
"

alias gpr="claude -p 'å¤‰æ›´å·®åˆ†ã‚’ç¢ºèªã—ã¦PRã®å†…å®¹ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚å¿…ãšæ—¥æœ¬èªã§ä½œæˆã—ã¦ãã ã•ã„ã€‚å¿…ãšDraftã§ä½œæˆã™ã‚‹ã“ã¨ã€‚å¿…ãš @.github/PULL_REQUEST_TEMPLATE ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ²¿ã‚ã›ã¦ãã ã•ã„ã€‚ä½œæˆå®Œäº†å¾Œã«ç¢ºèªã™ã‚‹ã®ã§Readyã«ã—ãªã„ã§ãã ã•ã„ã€‚ä½œæˆã—ãŸPRã®URLã‚’æœ€å¾Œã«å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚'"
alias c="claude"
alias ccm="ccmanager"


# run script with injecting 1password
# alias opi="op"
#==================
# Extra configuration
#==================

# Credentials
if [ -f "$HOME/.zshrc_secret" ]; then
  source "${HOME}/.zshrc_secret"
fi

# z
. "$(/opt/homebrew/bin/brew --prefix)"/etc/profile.d/z.sh
function zc(){
  z -r "$1";
  code .
}


export EDITOR="code"

# brew
eval "$(/opt/homebrew/bin/brew shellenv)"

# aqua
export AQUA_GLOBAL_CONFIG=${AQUA_GLOBAL_CONFIG:-}:${XDG_CONFIG_HOME:-$HOME/.config}/aquaproj-aqua/aqua.yaml
export PATH="${AQUA_ROOT_DIR:-${XDG_DATA_HOME:-$HOME/.local/share}/aquaproj-aqua}/bin:$PATH"
source <(aqua completion zsh)


# Go
export GOPATH=$HOME/go
export PATH=$PATH:$GOPATH/bin

# AWS-valut
export AWS_VAULT_KEYCHAIN_NAME="login"
export AWS_ASSUME_ROLE_TTL="1h"

# Starship
eval "$(starship init zsh)"


# direnv
eval "$(direnv hook zsh)"

# Completion
source <(kustomize completion zsh)

# node via aqua
export NPM_CONFIG_PREFIX=${XDG_DATA_HOME:-$HOME/.local/share}/npm-global
export PATH=$NPM_CONFIG_PREFIX/bin:$PATH


export PATH=$PATH:$HOME/flutter/bin
#==================
# Generative AI Settings
#==================
export OPENAI_URL="https://models.inference.ai.azure.com"
export OPENAI_MODEL=gpt-4o
export OPENAI_API_KEY=$(gh auth token)

#==================
# WezTerm
#==================
export PATH=$PATH:/Applications/WezTerm.app/Contents/MacOS
source <(wezterm shell-completion --shell zsh)

#==================
# Unsynced configuration
#==================
if [[ -e "$HOME/.private.zsh" ]]; then
    source $HOME/.private.zsh
fi
